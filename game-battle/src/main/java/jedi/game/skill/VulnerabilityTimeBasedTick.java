package jedi.game.skill;

import jedi.game.action.ActionEffect;
import jedi.game.battle.BattleContext;
import jedi.game.player.IBattleUnit;
import jedi.game.player.IEntity;
import jedi.game.player.Player;
import jedi.game.servercfg.enity.CfgSkill;
import jedi.game.skill.base.AbstractSkill;

// LangKey({1}{2}后，每{3}秒对{4}添加等于当前战斗时间秒数*{5}的易伤)_LangArgs(我方前军;战斗开始;1;敌方前军;2)
public class VulnerabilityTimeBasedTick  extends AbstractSkill {

    //施法者位置
    public String caster;

    //触发类型
    public int trigger;

    public long tick = -1; // 间隔时间，单位毫秒

    //目标类型
    public int target;


    public int stack;



    public VulnerabilityTimeBasedTick(CfgSkill cfgSkill) {
        super(cfgSkill);
    }

    @Override
    public void deduceParams(String params) {
        String[] param = params.split(";");
        this.caster = param[0];
        this.trigger = Integer.parseInt(param[1]);
        this.tick = Long.parseLong(param[2]);
        this.target = Integer.parseInt(param[3]);
        this.stack = Integer.parseInt(param[4]);
    }

    @Override
    public ActionEffect execute(BattleContext ctx, IEntity source, IEntity target, Player defender) {
        return null;
    }

    @Override
    public ActionEffect executeTick(BattleContext ctx, IEntity source, IEntity target, Player defender) {
        if (!(target instanceof IBattleUnit)) return null;

        IBattleUnit battleUnit = (IBattleUnit) target;


        int second = (int) (ctx.getCurrentTime() / 1000);

        int addStack = stack * second;

        if(addStack <= 0){
            return  null;
        }

        battleUnit.addVulnerable(addStack);

        ActionEffect actionEffect = getActionEffect(target);

        actionEffect.setValue(addStack);

        return actionEffect;
    }
}
